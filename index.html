html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a1a">
    <title>Serpiente Sabia 2D</title>
    <style>
        body {
            color: white;
            font-family: 'Courier New', monospace, sans-serif; /* Fuente pixelada para estilo retro */
            text-align: center;
            background-color: #1a1a1a; /* Fondo oscuro */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Alinea los elementos al inicio (arriba) */
            min-height: 100vh; /* Ocupa el 100% de la altura de la ventana */
            min-height: 100dvh; /* Dynamic viewport height para móviles */
            margin: 0;
            overflow: hidden; /* Ocultamos el scroll */
            padding: 5px 0; /* Pequeño padding para que el contenido no toque los bordes */
            box-sizing: border-box; /* Incluir padding en la altura total */
            /* ¡Solución recomendada! */
            touch-action: none; /* Fuerza al navegador a no interpretar gestos como zoom o scroll en todo el body */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Standard */
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }
        h1 {
            color: #00ff00; /* Verde neón para el título */
            font-size: clamp(1.2em, 4vw, 1.6em); /* Responsive font size */
            margin-top: 5px; /* Margen superior muy reducido */
            margin-bottom: 5px;
        }
        canvas {
            background: #000;
            border: 2px solid #00ff00; /* Borde verde neón */
            display: block;
            margin: 5px auto; /* Margen vertical muy reducido */
            max-width: 95vw; /* Responsive width */
            max-height: 60vh; /* Responsive height */
            /* ¡Solución recomendada! */
            touch-action: none; /* Fuerza al navegador a no interpretar gestos como zoom o scroll en el canvas */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        #game-header { /* Contenedor superior para instrucciones, puntaje y nivel */
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 400px; /* Ancho del canvas */
            margin-bottom: 5px;
        }
        #instructions {
            font-size: 0.7em; /* Aún más pequeño para instrucciones */
            margin-bottom: 3px; /* Reducir aún más el margen inferior */
            color: #ccc;
        }
        #score-level-bar {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Alinea verticalmente los elementos */
            width: 100%;
            font-size: 0.9em; /* Más pequeño para puntaje/nivel */
            color: #fff;
            margin-top: 0px;
            padding: 0 5px;
            box-sizing: border-box;
        }
        #score, #level, #student-name-display { /* Ajustar para el nuevo display de nombre */
            margin: 0;
        }
        #student-name-display {
            color: #ffcc00; /* Color distintivo para el nombre */
        }

        /* --- Estilos para la Pantalla de Inicio --- */
        #start-screen {
            background-color: rgba(0, 0, 0, 0.95);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30; /* Para que esté por encima de todo */
            color: #00ff00;
            font-size: 1.2em;
        }
        #start-screen h2 {
            color: #00ff00;
            margin-bottom: 20px;
        }
        #start-screen p {
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        #start-screen input, #start-screen select {
            padding: 10px;
            font-size: 1em;
            border: 2px solid #00ff00;
            background-color: #333;
            color: white;
            margin-bottom: 15px;
            text-align: center;
            font-family: 'Courier New', monospace, sans-serif;
            max-width: 250px;
        }
        #start-screen button {
            background-color: #00ff00;
            color: #000;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-family: 'Courier New', monospace, sans-serif;
        }
        #start-screen button:hover {
            background-color: #00cc00;
        }

        /* --- Overlay de Instrucciones Iniciales --- */
        #initial-instructions-overlay {
            background-color: rgba(0, 0, 0, 0.95);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* Inicialmente oculto */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30; /* AHORA EN Z-INDEX 30 O SUPERIOR PARA ASEGURAR VISIBILIDAD DE BOTÓN */
            color: #00ff00;
            font-size: 1.1em;
            padding: 20px;
            box-sizing: border-box;
            user-select: none; /* Prevenir selección de texto al tocar */
            -webkit-user-select: none;
            -ms-user-select: none;
            -moz-user-select: none;
        }
        #initial-instructions-overlay p {
            margin-bottom: 8px;
            line-height: 1.3;
        }
        #initial-instructions-overlay .instructions-title {
            font-size: 1.3em;
            color: #00ff00;
            margin-bottom: 15px;
        }
        #initial-instructions-overlay .instructions-cta {
            font-size: 1.2em;
            color: #ffcc00;
            margin-top: 20px;
        }
        /* Estilo para el nuevo botón dentro del overlay de instrucciones */
        #begin-game-button { /* Renombrado para consistencia, antes 'touch-to-start-button' */
            background-color: #00ff00;
            color: #000;
            font-size: 1em; /* Ajustado al pedido */
            border: none;
            padding: 10px 20px; /* Ajustado al pedido */
            font-family: 'Courier New', monospace, sans-serif;
            cursor: pointer;
            margin-top: 20px;
            border-radius: 5px; /* Mantener bordes redondeados para estilo */
            transition: background-color 0.3s;
        }
        #begin-game-button:hover {
            background-color: #00cc00;
        }


        /* --- Estilos para la Pregunta en Overlay (solo durante el juego) --- */
        #question-overlay { /* Caja para la pregunta central y temporizador */
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            padding: 10px; /* Reducir padding */
            max-width: 70%;
            display: none; /* Inicialmente oculto */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            min-height: 100px; /* Asegurar un tamaño mínimo */
            box-sizing: border-box;
            user-select: none; /* Prevenir selección de texto al tocar */
            -webkit-user-select: none; /* Para iOS */
            -ms-user-select: none; /* Para IE/Edge */
            -moz-user-select: none; /* Para Firefox */
            touch-action: manipulation; /* Evitar comportamientos del navegador como el zoom con doble toque */
        }
        #question-overlay.slide-out {
            transform: translate(-50%, 150%);
            opacity: 0;
        }
        #overlay-question-text {
            font-size: 1em; /* Ajustar tamaño de la pregunta central */
            margin-bottom: 8px; /* Reducir margen */
            color: #fff;
        }
        #overlay-timer-text {
            font-size: 0.8em; /* Más pequeño para el temporizador */
            color: #ffcc00;
        }
        #game-over-screen {
            background-color: rgba(0, 0, 0, 0.9);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            display: none;
        }
        #game-over-screen h2 {
            color: #ff0000;
            font-size: 2.2em; /* Reducir tamaño de "Juego Terminado" */
            margin-bottom: 10px;
        }
        #game-over-screen p {
            font-size: 1.1em; /* Reducir tamaño de texto en game over */
            margin-bottom: 15px;
        }
        #restart-button {
            background-color: #00ff00;
            color: #000;
            border: none;
            padding: 8px 15px; /* Reducir padding del botón */
            font-size: 0.9em; /* Reducir tamaño de fuente del botón */
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #restart-button:hover {
            background-color: #00cc00;
        }
        /* Estilo para la pregunta que aparece debajo del juego */
        #current-question-display {
            font-size: 0.9em; /* Más pequeño para la pregunta de abajo */
            color: #00ff00;
            margin-top: 8px; /* Reducir margen superior */
            min-height: 2em; /* Mantener para evitar saltos si el texto es corto */
            max-width: 90%;
            text-align: center;
            padding: 0 5px;
            box-sizing: border-box;
        }

        /* Importar fuente de Google Fonts para estilo retro */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    </style>
</head>
<body>
    <h1>Serpiente Sabia 2D</h1>

    <div id="start-screen">
        <h2>Bienvenido a Serpiente Sabia</h2>
        <p>Ingresa tu nombre para comenzar:</p>
        <input type="text" id="student-name-input" placeholder="Tu nombre" maxlength="20">
        <p>Selecciona tu grado:</p>
        <select id="grade-selection">
            <option value="grado7">Grado 7</option>
            <option value="grado8">Grado 8</option>
            <option value="grado9">Grado 9</option>
        </select>
        <button id="start-game-button">¡Empezar a Jugar!</button>
    </div>

    <div id="initial-instructions-overlay">
        <p class="instructions-title">Instrucciones del Juego</p>
        <p>Mueve la serpiente con las **flechas del teclado** (PC) o **deslizando el dedo** en cualquier parte de la pantalla (móvil).</p>
        <p>Cuando aparezca una pregunta, busca la respuesta:</p>
        <p>• **Círculo rojo** = Verdadero</p>
        <p>• **Cuadrado gris** = Falso</p>
        <p>Responde bien para crecer. ¡Evita chocar!</p>
        <button id="begin-game-button">Toca aquí para empezar</button>
    </div>

    <div id="game-header">
        <p id="instructions">Desliza el dedo para mover. Come el **círculo rojo** (Verdadero) o el **cuadrado gris** (Falso).</p>
        <div id="score-level-bar">
            <p id="student-name-display"></p> <p id="score">Puntaje: 0</p>
            <p id="level">Nivel: 1</p>
        </div>
    </div>

    <canvas id="game" width="400" height="400"></canvas>

    <div id="question-overlay">
        <p id="overlay-question-text"></p>
        <p id="overlay-timer-text"></p>
    </div>

    <p id="current-question-display"></p>

    <div id="game-over-screen">
        <h2 id="game-over-title">¡Juego Terminado!</h2>
        <p id="final-score">Puntaje final: 0</p>
        <button id="restart-button">Jugar de Nuevo</button>
    </div>

    <script>
        // --- PREGUNTAS POR GRADO Y NIVEL ---
        const preguntasPorGrado = {
            "grado7": {
                1: [
                    { texto: "¿La descripción inicial del notario Utterson sugiere que es un hombre extrovertido y de emociones fácilmente expresables?", respuesta: false },
                    { texto: "¿La historia que cuenta Enfield sobre la puerta y el incidente con la niña implica que el personaje de Hyde es percibido como inofensivo por quienes lo encuentran?", respuesta: false },
                    { texto: "¿La descripción de la casa conectada a la puerta, con su aspecto cuidado, contrasta directamente con la apariencia deteriorada de la puerta en sí misma?", respuesta: true },
                    { texto: "¿La incapacidad de Enfield para describir concretamente a Hyde, más allá de una 'fuerte sensación de deformidad', indica que su recuerdo del hombre es vago e impreciso?", respuesta: false },
                    { texto: "¿El pacto final propuesto por Enfield al final del capítulo implica que ambos hombres han decidido ignorar por completo el misterio que rodea a Hyde?", respuesta: true }
                ],
                2: [
                    { texto: "¿El desagrado que Utterson sentía por Hyde era tan profunda que no podía explicarse solo por los rasgos físicos negativos que observó en él?", respuesta: true },
                    { texto: "¿Antes de que Utterson le preguntara, Lanyon ya había escuchado el nombre de Hyde?", respuesta: false },
                    { texto: "¿En sus sueños, Utterson sentía una curiosidad muy fuerte e irresistible por conocer el rostro de Hyde?", respuesta: true },
                    { texto: "¿El testamento de Jekyll establecía que Hyde tomaría posesión de sus bienes si el doctor desaparecía por un periodo superior a tres meses?", respuesta: true },
                    { texto: "¿Utterson consideró que no tenía ninguna culpa en su pasado al analizarlo?", respuesta: false }
                ],
                3: [
                    { texto: "¿El doctor Jekyll y Utterson eran viejos compañeros, como se indica en el texto?", respuesta: true },
                    { texto: "¿Al inicio de la conversación, el doctor Jekyll mostró muchas ganas de hablar del tema del testamento?", respuesta: false },
                    { texto: "¿Jekyll describió a Lanyon como un 'pedante ignorante y presuntuoso'?", respuesta: true },
                    { texto: "¿El doctor Jekyll aseguró a Utterson que podía liberarse del señor Hyde en cualquier momento que quisiera?", respuesta: true },
                    { texto: "¿Utterson le prometió a Jekyll que toleraría a Hyde y tutelaría sus intereses legítimos cuando él ya no estuviera?", respuesta: true }
                ],
                4: [
                    { texto: "¿El cielo estaba cubierto por una densa niebla a la hora en que la camarera subió a su habitación?", respuesta: false },
                    { texto: "¿La camarera había visto a Hyde en varias ocasiones antes del incidente?", respuesta: false },
                    { texto: "¿Sir Danvers Carew llevaba consigo alguna tarjeta de identificación o documento, además de la carta, que facilitara su reconocimiento inmediato?", respuesta: false },
                    { texto: "¿La anciana que abrió la puerta en la casa de Hyde informó que él nunca estaba ausente por largos periodos?", respuesta: false },
                    { texto: "¿Se encontraron fotografías de Hyde o descripciones consistentes de su apariencia que facilitaran su búsqueda?", respuesta: false }
                ],
                5: [
                    { texto: "¿La camarera se desmayó por el horror de lo que vio y oyó?", respuesta: true },
                    { texto: "¿El señor Hyde le dirigió alguna palabra al anciano caballero antes de atacarlo?", respuesta: false },
                    { texto: "¿La víctima, Sir Danvers Carew, llevaba consigo alguna tarjeta de identificación?", respuesta: false },
                    { texto: "¿Se podría inferir que el señor Hyde era una persona querida en el barrio donde vivía, basándose en la reacción de la anciana que abrió la puerta?", respuesta: false },
                    { texto: "¿Es válido afirmar que la descripción de Hyde por parte de los pocos que lo conocían era consistente y uniforme?", respuesta: false }
                ],
                6: [
                    { texto: "¿Utterson fue recibido en la parte de la casa del doctor Jekyll que había sido comprada a los herederos de un famoso cirujano?", respuesta: true },
                    { texto: "¿El doctor Jekyll le dijo a Utterson que había quemado el sobre de la carta de Hyde porque no tenía matasellos?", respuesta: true },
                    { texto: "¿El señor Guest afirmó que la caligrafía de la carta de Hyde y la nota de Jekyll eran idénticas, con la misma inclinación?", respuesta: false },
                    { texto: "¿Se puede inferir que el doctor Jekyll estaba más preocupado por su reputación que por el paradero de Hyde, basándose en su conversación con Utterson sobre la carta?", respuesta: true },
                    { texto: "¿Considerando el diálogo entre Utterson y Poole, es plausible que la carta de Hyde realmente hubiera sido entregada en mano por alguien de fuera de la casa, tal como le indicó Jekyll a Utterson?", respuesta: false }
                ],
                7: [
                    { texto: "¿Hyde desapareció de su casa de Soho la misma mañana del delito de Sir Danvers?", respuesta: true },
                    { texto: "¿El doctor Jekyll volvió a su aislamiento y dejó de frecuentar a sus amigos antes de que Utterson notara un cambio en él?", respuesta: false },
                    { texto: "¿El doctor Lanyon le reveló a Utterson la razón exacta de su ruptura con el doctor Jekyll antes de morir?", respuesta: false },
                    { texto: "¿Se puede inferir que la 'desaparición' a la que se refería el testamento de Jekyll era de la misma índole que la que se insinuaba en la carta de Lanyon?", respuesta: true },
                    { texto: "¿Es justo decir que el doctor Jekyll, después de la desaparición de Hyde, llevó una vida más activa y dedicada a obras de caridad durante un tiempo?", respuesta: true }
                ],
                8: [
                    { texto: "¿Utterson y Enfield se detuvieron a mirar la puerta de la casa de Jekyll durante su paseo dominical?", respuesta: true },
                    { texto: "¿El doctor Jekyll les pidió a Utterson y Enfield que subieran a su laboratorio para hablar con ellos?", respuesta: false },
                    { texto: "¿El rostro del doctor Jekyll se contrajo en una mueca de terror después de sonreír a sus visitantes?", respuesta: true },
                    { texto: "¿Se puede inferir que el doctor Jekyll estaba en un buen estado de ánimo antes de que su rostro cambiara repentinamente?", respuesta: true },
                    { texto: "¿La reacción de Utterson y Enfield al ver el rostro del doctor Jekyll sugiere que este comportamiento era normal para él?", respuesta: false }
                ],
                9: [
                    { texto: "¿Poole le informó a Utterson que el doctor Jekyll se había vuelto cada vez más activo y sociable en los últimos días?", respuesta: false },
                    { texto: "¿Poole le pidió a Utterson que lo acompañara a la casa del doctor Jekyll porque temía que hubiera ocurrido un juego sucio?", respuesta: true },
                    { texto: "¿Utterson encontró al doctor Jekyll en su laboratorio cuando llegó a la casa?", respuesta: false },
                    { texto: "¿Se puede inferir que Poole estaba preocupado por el doctor Jekyll por la forma en que lo describió y su insistencia en buscar ayuda?", respuesta: true },
                    { texto: "¿La actitud de Poole al describir la voz de la persona en el laboratorio sugiere que creía que Jekyll simplemente estaba enfermo y no era otra persona?", respuesta: false }
                ],
                10: [
                    { texto: "¿El doctor Lanyon recibió una carta certificada de su colega Henry Jekyll el nueve de enero?", respuesta: true },
                    { texto: "¿El doctor Jekyll le pidió a Lanyon que fuera a su casa en taxi para recoger algo de su cuarto de trabajo?", respuesta: true },
                    { texto: "¿Poole le entregó un cajón con varios frascos y papeles al doctor Lanyon?", respuesta: true },
                    { texto: "¿Se puede inferir que el doctor Jekyll le estaba pidiendo a Lanyon que hiciera algo en contra de sus principios éticos al inicio de la carta?", respuesta: true },
                    { texto: "¿La descripción de la transformación que Lanyon presenció es tan vaga que no permite formarse una idea clara de lo que sucedió?", respuesta: false }
                ]
            },
            "grado8": {
                1: [
                    { texto: "¿La declaración inicial de Juan Pablo Castel de haber matado a María Iribarne busca primordialmente una confesión de culpa y establecer quién narra desde el comienzo?", respuesta: true },
                    { texto: "¿La afirmación de Castel de que los criminales son 'gente más limpia, más inofensiva' implica que él ve su propio acto de asesinato como una acción justificable y superior a las 'bajezas' sociales?", respuesta: true },
                    { texto: "¿La justificación de Castel para escribir su historia, la cual atribuye a la vanidad humana contradice su aparente desinterés por la 'opinión y la justicia de los hombres'?", respuesta: true },
                    { texto: "¿La anécdota de la madre de Castel, donde él sintió 'vanidoso orgullo' al acudir a su lado enferma sirve para eximirlo de toda crítica?", respuesta: false },
                    { texto: "¿La 'débil esperanza' de Castel de que 'alguna persona llegue a entenderme' a pesar de su escepticismo sobre la humanidad, sugiere una profunda necesidad de conexión o validación que contradice su misantropía?", respuesta: true },
                    { texto: "¿La ausencia de la mujer en la inauguración de la exposición, después de su primera aparición, genera en Castel un sentimiento de alivio al saber que su presencia no fue significativa para nadie más?", respuesta: true },
                    { texto: "¿La obsesión de Castel con la mujer que miraba su cuadro sugiere un anhelo de comprensión profunda o una idealización que lo lleva a proyectar sus propias necesidades en ella?", respuesta: true },
                    { texto: "¿La aversión de Castel hacia los grupos, las sectas y los gremios se limita a una mera manía personal, no tiene una justificación crítica?", respuesta: false },
                    { texto: "¿El desprecio de Castel por los críticos de arte se basa en su experiencia personal como artista incomprendido y en una convicción general de que aquellos sin experiencia práctica no deben juzgar a los creadores?", respuesta: true },
                    { texto: "¿La incapacidad de Castel para entablar conversación con mujeres desconocidas, a pesar de su deseo, revela una timidez insuperable o una forma de auto-sabotaje que lo condena a la soledad?", respuesta: true }
                ],
                2: [
                    { texto: "¿La reflexión de Castel sobre su 'maldita costumbre de querer justificar cada uno de mis actos' sugiere una autocrítica?", respuesta: true },
                    { texto: "¿El descarte de Castel de la idea de encontrar a la mujer a través de un amigo común, a pesar de reconocer la 'pequeña ventaja de la presentación', revela su orgullo por querer hacer todo él solo?", respuesta: true },
                    { texto: "¿La preferencia de Castel por la 'posibilidad más temida' de un encuentro casual en la calle, en lugar de una iniciativa propia, evidencia su deseo de control?", respuesta: true },
                    { texto: "¿La frustración de Castel al imaginar diálogos 'ridículos o desalentadores' con la mujer, indica que su mente es capaz de improvisar y adaptarse a las situaciones inesperadas en la interacción humana?", respuesta: false },
                    { texto: "¿La pregunta 'increíblemente estúpida' que Castel le hace a María Iribarne al entrar al edificio, a pesar del cartel, es un reflejo de su gran intelecto?", respuesta: false },
                    { texto: "¿El sonrojo de María Iribarne al ser reconocida por Castel sugiere una simple incomodidad ante la brusquedad de su acercamiento?", respuesta: true },
                    { texto: "¿La reacción inicial de Castel, al balbucear María que no recordaba la 'ventanita', lo lleva a concluir que su obsesión por ella era una 'construcción imaginaria' sin base en la realidad?", respuesta: true },
                    { texto: "¿El hecho de que María Iribarne persiga a Castel para disculparse después de su abrupta partida, contradice la idea de que ella era completamente indiferente a su presencia o al significado de la 'ventanita'?", respuesta: true },
                    { texto: "¿La 'lógica de hierro' que Castel utiliza para justificar su larga espera en el café para ver a María, demuestra una capacidad de razonamiento frío y calculado que despoja la situación de todo romanticismo?", respuesta: true },
                    { texto: "¿La sensación de que una 'gran fuerza, hasta ese momento dormida, se desencadenaría' en Castel tras el encuentro con María, presagia un desarrollo positivo en su relación?", respuesta: false }
                ],
                3: [
                    { texto: "¿La acción de Castel de arrastrar a María por la calle demuestra una total falta de consideración por su voluntad?", respuesta: true },
                    { texto: "¿La insistencia de Castel en la necesidad de María, a pesar de que él mismo no puede justificarla racionalmente, implica una dependencia emocional irracional?", respuesta: true },
                    { texto: "¿La incapacidad de Castel para articular claramente lo que siente o piensa sobre su pintura, a pesar de su intelecto, sugiere que su arte surge de una esfera más allá de la razón consciente?", respuesta: true },
                    { texto: "¿La afirmación de Castel de que 'nada tiene sentido' y la vida es una 'comedia inútil' sugiere que su búsqueda de María Iribarne es un intento consciente de darle un propósito a su existencia desprovista de significado?", respuesta: true },
                    { texto: "¿La frase de María 'Yo también pienso en usted' en la carta, se presenta como una declaración inequívoca de amor?", respuesta: false },
                     { texto: "¿La justificación de Castel de su misantropía, atribuyéndola a la observación de la 'codicia, la envidia, la petulancia' en los demás, le exime de cualquier responsabilidad en su propio desprecio por la humanidad?", respuesta: false },
                    { texto: "¿El tono 'oficinesco' de María al contestar el teléfono inicialmente es una evidencia de su frialdad y desinterés por Castel?", respuesta: false },
                    { texto: "¿La mención de la ceguera de Allende y el tamaño de sus libros implica que su condición física le impide comprender la complejidad del mundo y de las relaciones humanas?", respuesta: false },
                    { texto: "¿El 'cambio de voz' de María en el teléfono y la presencia de 'sombras' alrededor de ella son solo producto de la imaginación paranoica de Castel?", respuesta: true },
                    { texto: "¿La 'abominable comedia' a la que se refiere Castel al final del capítulo XII, se refiere exclusivamente al engaño de María?", respuesta: false }
                ],
                4: [
                    { texto: "¿La preocupación de Castel por la 'falta de sentido' de la existencia se ve aliviada por el hecho de que María comparta su 'mensaje de desesperanza'?", respuesta: true },
                    { texto: "¿La reacción de Castel al ver a María salir del subterráneo, donde la toma del brazo 'casi con brutalidad', evidencia una manifestación de su control y obsesión que domina cualquier rasgo de timidez?", respuesta: true },
                    { texto: "¿La aversión de Castel hacia los ciegos, comparándolos con 'animales, fríos, húmedos y silenciosos, como las víboras', es una manifestación de su prejuicio innato?", respuesta: true },
                    { texto: "¿El análisis de Castel sobre la carta de María, descartando la hipótesis de que ella quería disuadirlo, demuestra su tendencia a complicar las situaciones en lugar de aceptar explicaciones sencillas?", respuesta: true },
                    { texto: "¿El sueño de Castel sobre la 'vieja casa solitaria' que representa a María indica que su conexión con ella es puramente ilusoria y carece de una base en la realidad?", respuesta: false },
                    { texto: "¿La decisión de Castel de 'certificar' la segunda carta que le envió a María refleja una confianza en la eficacia de los métodos convencionales para asegurar su comunicación?", respuesta: true },
                    { texto: "¿La indignación de Castel cuando María le pregunta '¿por qué todo ha de tener respuesta?' demuestra una incapacidad para aceptar la ambigüedad y la complejidad de las relaciones humanas?", respuesta: true },
                    { texto: "¿El arrepentimiento de Castel de sus 'deducciones feroces' y el surgimiento de una 'desbordante ternura' hacia María, es una transformación duradera en su carácter?", respuesta: false },
                    { texto: "¿La discusión sobre la edad de María al final del fragmento es un mero detalle trivial?", respuesta: false },
                    { texto: "¿El hecho de que Castel diga 'no sé ahora qué le dije en aquel momento' sobre el próximo encuentro es una prueba de su falta de memoria?", respuesta: false }
                ],
                5: [
                    { texto: "¿La confesión de Castel sobre su desprecio general por la humanidad, a pesar de su afirmación de imparcialidad, sugiere que su relato es una justificación de su propia naturaleza misantrópica?", respuesta: true },
                    { texto: "¿La descripción de María en su carta, evocando 'recuerdos de otros tiempos' y el 'mar', implica que ella también comparte una melancolía y una profunda reflexión sobre la existencia similar a la de Castel?", respuesta: true },
                    { texto: "¿El hecho de que María sonriera al ser confrontada por Castel sobre la veracidad de su cariño implica una actitud de burla hacia él y su obsesión?", respuesta: false },
                    { texto: "¿La incapacidad de Castel para articular claramente el 'amor verdadero' a pesar de emplear la expresión, revela una contradicción fundamental en su búsqueda de María?", respuesta: true },
                    { texto: "¿La explicación de María sobre por qué se hacía llamar 'señorita Iribarne', a pesar de ser casada logra disipar por completo las dudas de Castel sobre la existencia de otras relaciones?", respuesta: false },
                    { texto: "¿La reacción de Castel al ver a María y Hunter del brazo refleja una comprensión compasiva de la situación de ella?", respuesta: false },
                    { texto: "¿El hecho de que la luz del dormitorio de María no se encienda después de la de Hunter calma las ansiedades de Castel y le da una sensación de alivio sobre la relación de María con Hunter?", respuesta: false },
                    { texto: "¿El asesinato de María es el resultado de un plan premeditado y lógico de Castel, que culmina sus razonamientos sobre la infidelidad de ella?", respuesta: true },
                    { texto: "¿La confesión de Castel a Allende sobre la infidelidad de María es recibida por el ciego con sorpresa e incredulidad, pero sin una reacción violenta?", respuesta: false },
                    { texto: "¿La frase 'Solo existió un ser que entendía mi pintura', dicha por Castel en el calabozo, se refiere a alguien diferente de María?", respuesta: false }
                ],
                6: [
                    { texto: "¿La 'caverna negra' que se agranda dentro del cuerpo de Castel al final del libro, puede interpretarse como la consumación de su aislamiento, liberándolo de las expectativas de conexión con el mundo exterior?", respuesta: true },
                    { texto: "¿La incapacidad de Castel para razonar sobre la palabra 'insensato' del ciego al final del libro señala una resistencia a la autocrítica que, en su lógica distorsionada, le permite mantener su visión de la realidad sin cuestionar su propia culpabilidad?", respuesta: true },
                    { texto: "¿El hecho de que Castel siga pintando en el encierro significa que ha encontrado una forma de redención o de escapar de su tormento interno?", respuesta: false },
                    { texto: "¿El final del libro implica una resolución clara de los conflictos de Castel y una comprensión de su destino por parte del lector?", respuesta: false },
                    { texto: "¿El tema central del libro, tal como se infiere del fragmento final, es el amor romántico y la búsqueda de la felicidad en una relación de pareja?", respuesta: false },
                    { texto: "¿La obsesión de Castel con encontrar una persona que comprenda su arte refleja una búsqueda de validación externa más que un verdadero deseo de conexión humana?", respuesta: true },
                    { texto: "¿La violencia de Castel hacia María puede interpretarse como la culminación lógica de su incapacidad para distinguir entre amor y posesión?", respuesta: true },
                    { texto: "¿El aislamiento progresivo de Castel a lo largo de la novela sugiere que su misantropía es tanto causa como consecuencia de su alienación social?", respuesta: true },
                    { texto: "¿La escritura de la confesión de Castel puede verse como un último intento de comunicación y comprensión, contradictorio con su declarado desprecio por la humanidad?", respuesta: true },
                    { texto: "¿La descripción que hace Castel de su propia psicología demuestra una lucidez que contrasta con sus acciones irracionales?", respuesta: true }
                ],
                7: [
                    { texto: "¿El contraste entre la racionalidad aparente de Castel y sus acciones violentas sugiere una crítica a la confianza excesiva en la razón como guía moral?", respuesta: true },
                    { texto: "¿La relación entre Castel y María puede interpretarse como una metáfora de la imposibilidad de la comunicación auténtica entre los seres humanos?", respuesta: true },
                    { texto: "¿El arte en la novela se presenta como un refugio genuino frente a la alienación o como otra forma de aislamiento?", respuesta: true },
                    { texto: "¿La paranoia de Castel respecto a María refleja una proyección de sus propios impulsos destructivos más que una percepción real de traición?", respuesta: true },
                    { texto: "¿La soledad de Castel es presentada como una condición autoimpuesta que él mismo perpetúa a través de sus acciones?", respuesta: true },
                    { texto: "¿La confesión de Castel funciona como una justificación de sus actos más que como un verdadero examen de conciencia?", respuesta: true },
                    { texto: "¿El personaje de María representa principalmente una proyección de las necesidades psicológicas de Castel más que una persona independiente?", respuesta: true },
                    { texto: "¿La novela sugiere que el individualismo extremo de Castel es incompatible con cualquier forma de relación humana saludable?", respuesta: true },
                    { texto: "¿El final trágico de la historia era inevitable dado el carácter y las obsesiones de Castel?", respuesta: true },
                    { texto: "¿La estructura narrativa de la confesión permite al lector cuestionar la veracidad y objetividad del relato de Castel?", respuesta: true }
                ],
                8: [
                    { texto: "¿La crítica social implícita en la novela se centra en la superficialidad del mundo artístico e intelectual de Buenos Aires?", respuesta: true },
                    { texto: "¿El personaje de Allende representa una forma de sabiduría que contrasta con la intelectualización destructiva de Castel?", respuesta: true },
                    { texto: "¿La incapacidad de Castel para aceptar la ambigüedad en las relaciones humanas lo lleva a construir certezas falsas y destructivas?", respuesta: true },
                    { texto: "¿El amor obsesivo de Castel por María puede interpretarse como una forma de narcisismo más que como un sentimiento genuino hacia otra persona?", respuesta: true },
                    { texto: "¿La repetición de patrones de pensamiento en Castel sugiere una mente atrapada en círculos viciosos que no puede romper?", respuesta: true },
                    { texto: "¿La violencia en la novela surge como resultado de la incomunicación más que de la maldad intrínseca?", respuesta: true },
                    { texto: "¿El contexto urbano y moderno de la novela contribuye al sentimiento de alienación que experimenta Castel?", respuesta: true },
                    { texto: "¿La relación entre creación artística y destrucción personal es un tema central en el desarrollo del personaje de Castel?", respuesta: true },
                    { texto: "¿La novela sugiere que la búsqueda de comprensión absoluta entre dos personas es una empresa imposible y potencialmente destructiva?", respuesta: true },
                    { texto: "¿El estilo directo y aparentemente objetivo de la narración contrasta irónicamente con la subjetividad extrema de la perspectiva de Castel?", respuesta: true }
                ],
                9: [
                    { texto: "¿La economía narrativa de la novela, concentrando una vida entera en momentos clave, refleja la intensidad de la obsesión de Castel?", respuesta: true },
                    { texto: "¿El pesimismo existencial de Castel puede verse como una respuesta a la condición humana en la modernidad?", respuesta: true },
                    { texto: "¿La ausencia de otros personajes desarrollados en profundidad refuerza el aislamiento subjetivo de Castel?", respuesta: true },
                    { texto: "¿El tiempo narrativo acelerado hacia el final de la novela refleja la inevitabilidad del desenlace trágico?", respuesta: true },
                    { texto: "¿La confesión como género literario permite explorar la psicología criminal desde una perspectiva íntima?", respuesta: true },
                    { texto: "¿La aparente lucidez de Castel sobre su propia condición hace más perturbador su comportamiento destructivo?", respuesta: true },
                    { texto: "¿El contraste entre la Buenos Aires cosmopolita y el mundo interior claustrofóbico de Castel crea una tensión narrativa significativa?", respuesta: true },
                    { texto: "¿La novela presenta el arte como una posible vía de comunicación que fracasa debido a las limitaciones del artista?", respuesta: true },
                    { texto: "¿El final abierto de la novela invita al lector a reflexionar sobre las causas profundas de la violencia humana?", respuesta: true },
                    { texto: "¿La brevedad de la novela intensifica el impacto emocional de la historia narrada?", respuesta: true }
                ],
                10: [
                    { texto: "¿La estructura circular de la narración, que comienza y termina con el crimen, refuerza la sensación de destino inevitable?", respuesta: true },
                    { texto: "¿El uso del presente narrativo en algunos pasajes crea una sensación de inmediatez que involucra más al lector?", respuesta: true },
                    { texto: "¿La psicología de Castel puede interpretarse como un estudio de la paranoia y sus efectos destructivos?", respuesta: true },
                    { texto: "¿La novela sugiere que la incapacidad de comunicación es una característica fundamental de la condición humana moderna?", respuesta: true },
                    { texto: "¿El crimen pasional de Castel representa una crítica a la racionalización excesiva de las emociones?", respuesta: true },
                    { texto: "¿La ausencia de redención o crecimiento personal en Castel hace de la novela una obra fundamentalmente pesimista?", respuesta: true },
                    { texto: "¿El estilo sobrio y directo de la prosa contrasta efectivamente con la intensidad emocional del contenido?", respuesta: true },
                    { texto: "¿La universalidad de los temas tratados trasciende el contexto específico argentino de la novela?", respuesta: true },
                    { texto: "¿La influencia del existencialismo europeo es evidente en la exploración de temas como la soledad y la incomunicación?", respuesta: true },
                    { texto: "¿El túnel como metáfora central de la novela representa tanto el aislamiento como la búsqueda desesperada de conexión?", respuesta: true }
                ]
            },
            "grado9": {
                1: [
                    { texto: "¿Alexander Coid se despertó al amanecer por una pesadilla?", respuesta: true },
                    { texto: "¿Soñaba Alex que un enorme perro negro se llevaba a su madre?", respuesta: false },
                    { texto: "¿El perro de Alex, Poncho, había sido mordido por un venado?", respuesta: true },
                    { texto: "¿La madre de Alex se afeitó el cabello por gusto?", respuesta: false },
                    { texto: "¿Alex rompió sus pertenencias en la habitación de sus padres?", respuesta: false },
                    { texto: "¿El padre de Alex le dijo que iría al Amazonas solo?", respuesta: true },
                    { texto: "¿Alex estaba emocionado de ir al Amazonas con su abuela Kate?", respuesta: false },
                    { texto: "¿Morgana le robó la cartera a Alex en el bus?", respuesta: true },
                    { texto: "¿Alex creía que el Amazonas estaba lleno de mosquitos y enfermedades?", respuesta: true },
                    { texto: "¿La abuela Kate le enseñó a Alex a fumar para que le dejara de gustar?", respuesta: true }
                ],
                2: [
                    { texto: "¿'Quien boca tiene, a Roma llega' era uno de los axiomas de Kate Coid?", respuesta: true },
                    { texto: "¿Alex era un muchacho tímido y le costaba abordar a desconocidos?", respuesta: true },
                    { texto: "¿Alex consideró que las instrucciones del empleado del restaurante eran fáciles de entender?", respuesta: false },
                    { texto: "¿El hombre que masticaba una hamburguesa le dio a Alex instrucciones claras para llegar a la calle Catorce con la Segunda Avenida?", respuesta: false },
                    { texto: "¿Alex consideró que caminar unas pocas cuadras por terreno plano era más difícil que escalar montañas?", respuesta: false },
                    { texto: "¿El sacerdote afirmó que los indios eran primitivos en lo material pero avanzados en el plano mental?", respuesta: true },
                    { texto: "¿El padre Valdomero vio a la Bestia hace solo unos meses?", respuesta: false },
                    { texto: "¿La Bestia que vio el padre Valdomero medía menos de dos metros de altura?", respuesta: false },
                    { texto: "¿La Bestia atacó al padre Valdomero?", respuesta: false },
                    { texto: "¿El padre Valdomero estaba seguro de que la criatura emitió solo gruñidos y no habló?", respuesta: false }
                ],
                3: [
                    { texto: "¿La tormenta en el capítulo 'El Chaman' cesó súbitamente al amanecer?", respuesta: false },
                    { texto: "¿El profesor Leblanc exigió que la expedición se pusiera en marcha hacia el Alto Orinoco al día siguiente?", respuesta: true },
                    { texto: "¿La interrupción de la doctora Omayra Torres buscaba establecer un trato profesional y de igualdad con el profesor Leblanc?", respuesta: true },
                    { texto: "¿Kate Coid le había contado a su nieto que el Amazonas era un lugar peligroso para los antropólogos?", respuesta: true },
                    { texto: "¿El texto sugiere que la visión de los indios como 'primitivos en lo material pero muy avanzados en lo mental' es una forma de esencializar o simplificar su cultura?", respuesta: true },
                    { texto: "¿Alex aceptó la piña que le ofreció Nadia a pesar del riesgo de contraer una enfermedad?", respuesta: true },
                    { texto: "¿El profesor Leblanc se bañó en el río con el resto de la expedición?", respuesta: false },
                    { texto: "¿El texto presenta al chamán como una figura que utiliza elementos místicos y rituales para imponer respeto y autoridad dentro de su comunidad?", respuesta: true },
                    { texto: "¿La abuela de Alex le dijo que, si una mantarraya lo atacaba, significaba que esas aguas no eran para él?", respuesta: true },
                    { texto: "¿El texto sugiere que la figura del chamán representa una conexión con lo sobrenatural y un poder espiritual que es comprensible para la cultura occidental?", respuesta: false }
                ],
                4: [
                    { texto: "¿El lujo ostentoso del campamento de Mauro Carías, evidenciado por sus remolques y equipos, contradice la idea de que sus operaciones en el Amazonas eran puramente de bajo impacto ecológico?", respuesta: true },
                    { texto: "¿La decisión de Alex de comer anaconda, a pesar de sus reservas iniciales, puede interpretarse como un paso significativo en su proceso de adaptación y apertura a las costumbres locales?", respuesta: true },
                    { texto: "¿La reticencia del profesor Leblanc a sumergirse en el río con el resto de la expedición sugiere una fuerte conexión con el ambiente natural?", respuesta: false },
                    { texto: "¿La figura del profesor Leblanc es irónica al mostrar que a pesar de ser uno de los mas grandes antropólogos su conocimiento y experiencia son pocos?", respuesta: true },
                    { texto: "¿La seguridad reforzada del campamento de Carías, con alambres electrificados y guardias armados, indica que sus actividades comerciales en la selva eran completamente legales y transparentes?", respuesta: false },
                    { texto: "¿La reacción del profesor Leblanc ante el ataque de la anaconda puede tomarse como empática?", respuesta: false },
                    { texto: "¿La aparente despreocupación de César Santos por los riesgos del río, como las mantarrayas, contrasta con la cautela del profesor Leblanc, revelando una diferencia fundamental en sus percepciones del peligro amazónico?", respuesta: true },
                    { texto: "¿La mención de que la anaconda sabía a atún con un 'vago sabor de pollo' es una descripción literal de su gusto o una forma de Alex de buscar familiaridad en lo desconocido?", respuesta: true },
                    { texto: "¿La insistencia de Alex en que su abuela fotografiara la piel de anaconda, incluso en un momento de vulnerabilidad emocional, demuestra una priorización de la evidencia material sobre la experiencia subjetiva?", respuesta: true },
                    { texto: "¿El contraste entre los bienes de César Santos y los de Carías es utilizado por el autor para simbolizar la disparidad de poder y recursos entre los personajes en la selva?", respuesta: true }
                ],
                5: [
                    { texto: "¿La distribución de los turnos de guardia, excluyendo al profesor Leblanc por su necesidad de 'lucidez', revela una jerarquía implícita donde la comodidad de algunos se prioriza sobre la igualdad de responsabilidades en una situación de peligro?", respuesta: true },
                    { texto: "¿La persistente fatiga de Alex, en contraste con la aparente fortaleza de Nadia en la caminata, sugiere que la resistencia en la selva está más ligada a la condición física y no a la mental?", respuesta: false },
                    { texto: "¿El hecho de que el 'extraño y persistente olor' que se percibía en el bosque se asociara a la Bestia, fomenta un clima de miedo irracional o una premonición de un encuentro inminente?", respuesta: true },
                    { texto: "¿La dificultad de Alex para conciliar el sueño, a pesar del cansancio físico, se debe únicamente a los ruidos del bosque?", respuesta: true },
                    { texto: "¿La observación de Alex sobre los hábitos alimenticios de los indios, acostumbrados a almacenar energía, implica una crítica sutil a la dependencia occidental de la comida constante y refrigerada?", respuesta: true },
                    { texto: "¿La decisión de Alex de no cepillarse los dientes ni cambiarse de ropa representa que aún no se ha adaptado a la vida selvática?", respuesta: false },
                    { texto: "¿La inminente llegada a la 'montaña muy alta y una magnífica catarata' al final del capítulo, sugiere una conclusión o un nuevo comienzo en la búsqueda de la Bestia por parte de la expedición?", respuesta: true },
                    { texto: "¿La preocupación de Alex por su rescate y la búsqueda de señales para un helicóptero, en contraposición con la entrega de Nadia a la aventura, subraya una similitud en las expectativas y mentalidades sobre la expedición?", respuesta: false },
                    { texto: "¿La descripción del 'clamor de guerra' con el que cae la catarata, augura un enfrentamiento o una prueba significativa para los protagonistas al llegar a este lugar?", respuesta: true },
                    { texto: "¿La exclusión del profesor Leblanc de los turnos de guardia se justifica plenamente por su rol de 'jefe de la expedición' y su necesidad de mantenerse 'fresco' para tomar decisiones cruciales?", respuesta: false }
                ],
                6: [
                    { texto: "¿La reacción agresiva de Mokarita ante la negativa de Nadia a escalar la montaña, se interpreta como una clara señal de que el jefe de las plumas amarillas era inherentemente un líder tiránico y sin consideración?", respuesta: false },
                    { texto: "¿La experiencia de Alex en la escalada le asegura una confianza total para afrontar la roca negra y húmeda sin sentir ningún temor?", respuesta: false },
                    { texto: "¿La intervención de la 'gente diminuta' en la escalada, es una evidencia de que la expedición ya había comprendido y aceptado la existencia de seres no catalogados por la ciencia?", respuesta: false },
                    { texto: "¿La apariencia de Alex como un 'pálido turista' en la aldea de los Indios de la Niebla sugiere que su integración en la comunidad indígena era completamente imposible y que siempre sería percibido como un forastero?", respuesta: false },
                    { texto: "¿El 'impulso de huida' que Alex experimenta ante las picaduras de las hormigas de fuego finalmente lo lleva a abandonar la prueba, demostrando una incapacidad para superar el sufrimiento?", respuesta: false },
                    { texto: "¿La prueba de las hormigas de fuego, al ser un rito doloroso se presenta como un acto de crueldad gratuita por parte de los indígenas sin ningún propósito simbólico o de iniciación?", respuesta: false },
                    { texto: "¿La magnitud de la catarata, descrita como un 'rugido de guerra' indica que su sonido era tan ensordecedor que impedía cualquier tipo de comunicación o pensamiento racional en su cercanía?", respuesta: false },
                    { texto: "¿La 'impresión de poder' que invadió a Alex tras la prueba de las hormigas de fuego significa que él considera haber alcanzado el nivel de fuerza física de un guerrero experimentado, similar a los indígenas?", respuesta: false },
                    { texto: "¿La reacción de los Indios de la Niebla al ver a Alex y Nadia escalando la montaña, con una mezcla de curiosidad y la acción de lanzarles comida, sugiere una valoración de la resistencia y un rito de bienvenida implícito a los forasteros?", respuesta: true },
                    { texto: "¿La decisión de Alex y Nadia de ir solos a enfrentar el 'último desafío' con los Indios de la Niebla, a pesar de los riesgos, indica una creciente confianza en sus propias habilidades y en su conexión con el mundo indígena, superando la dependencia de los adultos de la expedición?", respuesta: true }
                ],
                7: [
                    { texto: "¿La visión delirante de Alex de su madre en el hospital, mientras él arde de fiebre en la selva, sugiere que su conexión telepática se intensifica en momentos de vulnerabilidad extrema?", respuesta: true },
                    { texto: "¿El hecho de que Lisa Coid 'no se preguntó cómo ni por qué' vio a su hijo indica una aceptación innata de fenómenos inexplicables que contrasta con la racionalidad occidental?", respuesta: true },
                    { texto: "¿La Bestia muestra signos de agresividad o resistencia inicial ante el baile de Nadia, evidenciando una amenaza inminente a la seguridad de los expedicionarios?", respuesta: false },
                    { texto: "¿La danza de Nadia, descrita como 'un regalo para los dioses' y sin previa preparación, es una manifestación puramente instintiva y nada tiene que ver con una profunda conexión con el conocimiento ancestral de los indios?", respuesta: false },
                    { texto: "¿La música creada por Nadia y Alex en el tepui, a pesar de ser novedosa para las Bestias, es presentada como una amenaza a su tranquilidad o como una invasión cultural indeseable?", respuesta: false },
                    { texto: "¿La aparición de la 'Bestia' ante Alex y Nadia se describe como un encuentro aterrador y peligroso, confirmando las advertencias previas del padre Valdomero sobre su naturaleza violenta?", respuesta: false },
                    { texto: "¿El temor de los 'hombres invisibles' a ser vistos por las Bestias era algo absurdo que no tenía relación con sus dioses?", respuesta: false },
                    { texto: "¿El detalle de que las Bestias 'jamás se había oído música' en miles de años en el tepui, sugiere un vacío cultural o una forma de vida que prioriza la conexión con la naturaleza sobre las expresiones artísticas humanas?", respuesta: true },
                    { texto: "¿La ausencia de cualquier forma de comunicación verbal entre las Bestias y los humanos durante el primer encuentro indica que su interacción futura será imposible o estará limitada a la telepatía?", respuesta: false },
                    { texto: "¿La descripción de las Bestias como 'pesados seres' indica que no hay forma de que ellos ataquen o se defiendan de los humanos?", respuesta: false }
                ],
                8: [
                    { texto: "¿La condición impuesta por las Bestias de que Alex y Nadia realicen sus misiones solos, a pesar de sus deseos de compañía, implica que el crecimiento espiritual requiere una confrontación individual con los desafíos?", respuesta: true },
                    { texto: "¿La envidia que Alex siente por la existencia 'libre y silenciosa' de Nadia, a pesar de su propia vida occidental, sugiere una crítica subyacente del narrador a la superficialidad de la civilización moderna?", respuesta: true },
                    { texto: "¿La advertencia de Walimaí de que si no regresan al anochecer quedarán 'atrapados en el tepui sagrado', es una amenaza real o una metáfora de la pérdida de su conexión con el mundo exterior si fallan en su misión?", respuesta: true },
                    { texto: "¿La decisión de Alex y Nadia de pasar el resto del día 'recorriendo El Dorado y contándose sus cortas vidas' antes de separarse, evidencia una madurez emocional que prioriza la conexión humana ante un desafío inminente?", respuesta: true },
                    { texto: "¿La experiencia de Alex y Nadia con el humo de la pimienta, la que les provoca visiones aterradoras, es presentada como un mero delirio?", respuesta: true },
                    { texto: "¿Alex desciende a las 'profundidades de la tierra' para encontrar los huevos?", respuesta: false },
                    { texto: "¿La incapacidad de Alex para calcular cuánto tiempo estuvieron dormidos después de inhalar el humo de la pimienta, indica que sus vivencias en la ciudad dorada fue puramente un efecto secundario negativo de la droga?", respuesta: false },
                    { texto: "¿El hecho de que Alex y Nadia no tuvieran miedo a los 'monstruos acechando' en la oscuridad total de la cueva, implica que su valentía era innata y que habían superado por completo cualquier temor a lo desconocido?", respuesta: false },
                    { texto: "¿La 'suave penumbra' en la cueva al despertar Alex y Nadia, en contraste con la oscuridad total previa, simboliza que su experiencia con el chamán les ha otorgado una nueva percepción o claridad sobre su entorno?", respuesta: false },
                    { texto: "¿La reacción de Borobá al 'gemir asustado' y no soltarse de Nadia durante la experiencia con el humo de la pimienta, contrasta con la aparente resistencia de los jóvenes, sugiriendo una mayor sensibilidad o vulnerabilidad en los animales a estas experiencias?", respuesta: true }
                ],
                9: [
                    { texto: "¿La falta de conocimiento de Nadia sobre elementos como las computadoras o el invierno, implica una desventaja significativa para ella en el mundo occidental y una incapacidad para adaptarse fuera de su entorno natural?", respuesta: false },
                    { texto: "¿Walimaí se llevó los huevos de cristal que le dio Nadia?", respuesta: true },
                    { texto: "¿La doctora Omayra Torres dijo que el sarampión podía matar a la tribu si no se vacunaban?", respuesta: true },
                    { texto: "¿Nadia y Alex contaron todo lo que sabían sobre el tepui sagrado a Mauro Carías y los militares?", respuesta: false },
                    { texto: "¿Iyomi aceptó sin discutir que los nahab vacunaran a su gente?", respuesta: false },
                    { texto: "¿Karakawe denunció a Mauro Carías y a la doctora Torres frente al grupo?", respuesta: true },
                    { texto: "¿El capitán Ariosto disparó a Karakawe después de su denuncia?", respuesta: true },
                    { texto: "¿Mauro Carías destruyó las vacunas para evitar que fueran examinadas?", respuesta: true },
                    { texto: "¿La doctora Omayra Torres mostró señales de arrepentimiento por su complicidad en el plan de exterminio?", respuesta: false },
                    { texto: "¿Alexander fue atado a un árbol como castigo por parte de Ariosto?", respuesta: true }
                ],
                10: [
                    { texto: "¿Al final del fragmento la expedición está a salvo y en control de la situación?", respuesta: false },
                    { texto: "¿Nadia logró salir del campamento sin ser vista por los soldados?", respuesta: true },
                    { texto: "¿Walimaí liberó a Alexander de las ataduras con una navaja?", respuesta: true },
                    { texto: "¿La Bestia atacó físicamente al capitán Ariosto con sus garras?", respuesta: true },
                    { texto: "¿Los soldados fueron testigos conscientes del ataque de las Bestias?", respuesta: false },
                    { texto: "¿Iyomi dio permiso para que la tribu se vacunara?", respuesta: true },
                    { texto: "¿Los indígenas sabían que los frascos contenían un virus antes de que murieran algunos?", respuesta: false },
                    { texto: "¿La presencia de Nadia ayudó a mejorar la comunicación entre los nahab y los indígenas?", respuesta: true },
                    { texto: "¿Las Bestias fueron utilizadas para castigar tanto a enemigos como a amigos?", respuesta: true },
                     { texto: "¿El profesor Leblanc fue nombrado presidente de la futura fundación para proteger la selva?", respuesta: true },
                     { texto: "¿Alexander se quedó con los diamantes para usarlos como prueba científica en su país?", respuesta: true }
                ]
            }
        };

        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        const questionOverlay = document.getElementById("question-overlay");
        const overlayQuestionText = document.getElementById("overlay-question-text");
        const overlayTimerText = document.getElementById("overlay-timer-text");
        const currentQuestionDisplay = document.getElementById("current-question-display");
        const scoreDisplay = document.getElementById("score");
        const levelDisplay = document.getElementById("level");
        const gameOverScreen = document.getElementById("game-over-screen");
        const gameOverTitle = document.getElementById("game-over-title");
        const finalScoreDisplay = document.getElementById("final-score");
        const restartButton = document.getElementById("restart-button");
        const instructionsDisplay = document.getElementById("instructions"); // Elemento para instrucciones generales

        // Elementos de la pantalla de inicio
        const startScreen = document.getElementById("start-screen");
        const studentNameInput = document.getElementById("student-name-input");
        const gradeSelection = document.getElementById("grade-selection");
        const startGameButton = document.getElementById("start-game-button");
        const studentNameDisplay = document.getElementById("student-name-display");

        // Overlay de instrucciones iniciales
        const initialInstructionsOverlay = document.getElementById("initial-instructions-overlay");
        // Botón dentro del overlay de instrucciones (renombrado para consistencia)
        const beginGameButton = document.getElementById("begin-game-button");


        const box = 20;
        let snake = [];
        let direction = null;
        let food = {}; // Manzana (Verdadero)
        let rat = {}; // Ratón (Falso)
        let score = 0;
        let level = 1;
        let gameSpeed = 200; // Velocidad inicial más lenta
        let selectedGradeQuestions = {};
        let studentName = ""; // Variable para almacenar el nombre del estudiante

        let currentLevelQuestions = [];

        let currentQuestion = null;

        let gamePausedForQuestion = true; // Para pausar durante la pregunta en overlay
        let overlayQuestionTimerInterval;
        let overlayTimeLeft = 0;
        const OVERLAY_QUESTION_DURATION = 8;

        let animationFrameId;
        let lastFrameTime = 0;
        let targetFrameRate;

        const QUESTIONS_TO_LEVEL_UP = 3;
        let questionsCorrectInCycle = 0;
        let questionsAnsweredInCycle = 0;
        let segmentsToAdd = 0;

        // Cola de movimientos para manejar entradas rápidas
        let moveQueue = [];

        // Variables para detección de gestos táctiles
        let touchStartX = 0;
        let touchStartY = 0;
        const SWIPE_THRESHOLD = 15; // Reducido para respuesta más rápida
        let touchStartTime = 0;

        // Variables para detección de gestos con el mouse (para PC sin touch)
        let mouseIsDown = false;
        let mouseStartX = 0;
        let mouseStartY = 0;

        // --- Detección de dispositivo táctil (para adaptar texto de instrucciones) ---
        function isTouchDevice() {
            return (('ontouchstart' in window) ||
                    (navigator.maxTouchPoints > 0) ||
                    (navigator.msMaxTouchPoints > 0));
        }
        const isMobile = isTouchDevice(); // Determinado una vez al cargar la página

        // --- FUNCIONES DE UTILIDAD ---
        function randomPosition() {
            let pos;
            const forbiddenPositions = new Set();
            for (let i = 0; i < snake.length; i++) {
                forbiddenPositions.add(`${snake[i].x},${snake[i].y}`);
            }
            if (food.x !== undefined) forbiddenPositions.add(`${food.x},${food.y}`);
            if (rat.x !== undefined) forbiddenPositions.add(`${rat.x},${rat.y}`);

            let attempts = 0;
            const maxAttempts = 100;
            do {
                pos = {
                    x: Math.floor(Math.random() * (canvas.width / box)) * box,
                    y: Math.floor(Math.random() * (canvas.height / box)) * box,
                };
                attempts++;
            } while (forbiddenPositions.has(`${pos.x},${pos.y}`) && attempts < maxAttempts);

            if (attempts >= maxAttempts) {
                console.warn("No se pudo encontrar una posición libre para la comida/ratón. Considera un mapa más grande o menos segmentos de serpiente.");
            }
            return pos;
        }

        function collision(head, array, checkAllSegments = false) {
            const startIndex = checkAllSegments ? 0 : 1;
            for (let i = startIndex; i < array.length; i++) {
                if (head.x === array[i].x && head.y === array[i].y) {
                    return true;
                }
            }
            return false;
        }

        // --- FUNCIÓN PARA AJUSTAR TAMAÑO DEL CANVAS EN MÓVILES ---
        function adjustCanvasSize() {
            const maxWidth = Math.min(400, window.innerWidth * 0.95);
            const maxHeight = Math.min(400, window.innerHeight * 0.6);

            // Mantener proporción cuadrada
            const size = Math.min(maxWidth, maxHeight);

            canvas.style.width = size + 'px';
            canvas.style.height = size + 'px';

            // Mantener la resolución interna del canvas
            canvas.width = 400;
            canvas.height = 400;
        }

        // --- INICIALIZACIÓN DEL JUEGO ---
        function initGame() {
            console.log("--- INICIO: Iniciando Juego ---");
            stopAnimationFrameLoop();
            clearInterval(overlayQuestionTimerInterval);
            adjustCanvasSize();

            const selectedGrade = gradeSelection.value;
            selectedGradeQuestions = {};
            for (const lvl in preguntasPorGrado[selectedGrade]) {
                selectedGradeQuestions[lvl] = [...preguntasPorGrado[selectedGrade][lvl]];
            }

            snake = [{ x: 9 * box, y: 10 * box }];
            direction = null;
            moveQueue = [];
            score = 0;
            level = 1;
            gameSpeed = 200;
            targetFrameRate = 1000 / (1000 / gameSpeed);
            questionsCorrectInCycle = 0;
            questionsAnsweredInCycle = 0;
            segmentsToAdd = 0;
            currentQuestion = null;
            food = {};
            rat = {};
            gamePausedForQuestion = true;

            scoreDisplay.innerText = "Puntaje: " + score;
            levelDisplay.innerText = "Nivel: " + level;
            gameOverScreen.style.display = "none";
            currentQuestionDisplay.innerText = "";
            gameOverTitle.innerText = "";
            finalScoreDisplay.innerText = "";

            studentNameDisplay.innerText = studentName ? `Jugador: ${studentName}` : "";

            // Ocultar overlays y mostrar elementos del juego
            startScreen.style.display = "none";
            initialInstructionsOverlay.style.display = "none"; // Asegurarse de ocultarlo
            canvas.style.display = "block";
            currentQuestionDisplay.style.display = "block";

            drawInitialState();

            loadLevelQuestionsForCurrentLevel();
            presentQuestion();
            console.log("INICIO: initGame finalizado. Esperando primera pregunta para iniciar bucle.");
        }

        function drawInitialState() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < snake.length; i++) {
                ctx.fillStyle = i === 0 ? "lime" : "green";
                ctx.fillRect(snake[i].x, snake[i].y, box, box);
            }
        }

        // --- Gestión de la Pantalla de Inicio y Instrucciones ---
        function showStartScreen() {
            console.log("ESTADO: Mostrando pantalla de inicio.");
            startScreen.style.display = "flex";
            canvas.style.display = "none";
            questionOverlay.style.display = "none";
            initialInstructionsOverlay.style.display = "none";
            currentQuestionDisplay.style.display = "none";
            gameOverScreen.style.display = "none";

            // Limpiar listeners antiguos para evitar duplicados
            startGameButton.removeEventListener('click', handleStartGameButtonClick);
            startGameButton.removeEventListener('touchend', handleStartGameButtonClick);
            studentNameInput.removeEventListener('keypress', handleNameInputKeyPress);

            // AÑADIDO: Limpiar listeners del botón de inicio del overlay por si acaso
            beginGameButton.removeEventListener("click", startActualGame);
            beginGameButton.removeEventListener("touchend", startActualGame);

            startGameButton.addEventListener('click', handleStartGameButtonClick);
            startGameButton.addEventListener('touchend', (e) => {
                e.preventDefault();
                handleStartGameButtonClick();
            }, { passive: false });
            studentNameInput.addEventListener('keypress', handleNameInputKeyPress);
            studentNameInput.focus();
        }

        function handleNameInputKeyPress(event) {
            if (event.key === 'Enter') {
                handleStartGameButtonClick();
            }
        }

        function handleStartGameButtonClick() {
            const name = studentNameInput.value.trim();
            if (name === "") {
                alert("Por favor, ingresa tu nombre para empezar.");
                return;
            }
            studentName = name; // Guardar el nombre

            console.log("ESTADO: Mostrando overlay de instrucciones iniciales.");
            startScreen.style.display = "none"; // Ocultar pantalla de inicio
            initialInstructionsOverlay.style.display = "flex"; // Mostrar instrucciones

            // AHORA: El botón dentro del overlay de instrucciones es el que inicia el juego
            beginGameButton.removeEventListener("click", startActualGame); // Limpiar para evitar duplicados
            beginGameButton.removeEventListener("touchend", startActualGame); // Limpiar eventos táctiles

            // Agregar tanto click como touchend para mejor compatibilidad con iOS
            beginGameButton.addEventListener("click", startActualGame);
            beginGameButton.addEventListener("touchend", (e) => {
                e.preventDefault();
                startActualGame();
            }, { passive: false });
        }



        function startActualGame() {
            console.log("INICIO: startActualGame llamado. Iniciando juego...");
            initialInstructionsOverlay.style.display = "none"; // Ocultar las instrucciones
            initGame(); // Iniciar el juego
        }

        function loadLevelQuestionsForCurrentLevel() {
            console.log(`PREGUNTAS: Cargando preguntas para Nivel ${level} del grado ${gradeSelection.value}.`);
            currentLevelQuestions = selectedGradeQuestions[level] ? [...selectedGradeQuestions[level]] : [];

            if (currentLevelQuestions.length === 0) {
                console.warn(`PREGUNTAS: No hay preguntas para el Nivel ${level} del grado ${gradeSelection.value}.`);
                if (level < Object.keys(selectedGradeQuestions).length) {
                    levelUp();
                } else {
                    endGame(true);
                }
            }
        }

        // --- LÓGICA DE PREGUNTAS Y RESPUESTAS ---
        function presentQuestion() {
            clearInterval(overlayQuestionTimerInterval);

            if (currentLevelQuestions.length === 0) {
                console.log("PREGUNTAS: No hay más preguntas disponibles en este nivel. Intentando avanzar de nivel...");
                if (level < Object.keys(selectedGradeQuestions).length) {
                    levelUp();
                    return;
                } else {
                    endGame(true);
                    return;
                }
            }

            const randomIndex = Math.floor(Math.random() * currentLevelQuestions.length);
            currentQuestion = currentLevelQuestions[randomIndex];

            console.log(`PREGUNTAS: Presentando pregunta en overlay: "${currentQuestion.texto}" (Respuesta: ${currentQuestion.respuesta ? 'Verdadero' : 'Falso'})`);

            overlayQuestionText.innerText = currentQuestion.texto;
            overlayTimeLeft = OVERLAY_QUESTION_DURATION;
            overlayTimerText.innerText = `Tiempo: ${overlayTimeLeft}s`;
            questionOverlay.classList.remove('slide-out');
            questionOverlay.style.transform = 'translate(-50%, -50%)';
            questionOverlay.style.opacity = '1';
            questionOverlay.style.display = "flex";

            gamePausedForQuestion = true;
            stopAnimationFrameLoop(); // Pausar movimiento de serpiente

            overlayQuestionTimerInterval = setInterval(() => {
                overlayTimeLeft--;
                overlayTimerText.innerText = `Tiempo: ${overlayTimeLeft}s`;

                if (overlayTimeLeft <= 0) {
                    clearInterval(overlayQuestionTimerInterval);
                    console.log("PREGUNTAS: Tiempo de overlay de pregunta terminado.");

                    questionOverlay.classList.add('slide-out');
                    setTimeout(() => {
                        questionOverlay.style.display = "none";
                    }, 500);

                    currentQuestionDisplay.innerText = currentQuestion.texto;
                    gamePausedForQuestion = false; // Reanudar el juego
                    startAnimationFrameLoop(); // Reanudar el bucle de animación
                }
            }, 1000);

            placeFoodAndRat(currentQuestion.respuesta);
        }

        function placeFoodAndRat(correctAnswerIsTrue) {
            food = randomPosition();
            rat = randomPosition();

            while (food.x === rat.x && food.y === rat.y) {
                rat = randomPosition();
            }
            console.log(`COMIDA: Manzana en (${food.x},${food.y}), Ratón en (${rat.x},${rat.y}).`);
        }

        function checkAnswer(eatenItemIsFood) {
            console.log(`RESPUESTA: Serpiente comió ${eatenItemIsFood ? 'manzana (Verdadero)' : 'ratón (Falso)'}.`);
            const isCorrect = (eatenItemIsFood === currentQuestion.respuesta);

            if (isCorrect) {
                score += 1;
                questionsCorrectInCycle++;
                segmentsToAdd += 2; // CAMBIO: AHORA SUMA 2 SEGMENTOS EN LUGAR DE 1
                console.log("RESPUESTA: ¡Correcto! Puntaje:", score);
            } else {
                segmentsToAdd = Math.max(0, segmentsToAdd - 1);
                console.log("RESPUESTA: Incorrecto. Puntaje:", score);
            }
            questionsAnsweredInCycle++;
            scoreDisplay.innerText = "Puntaje: " + score;

            const answeredQuestionIndex = currentLevelQuestions.findIndex(q => q.texto === currentQuestion.texto);
            if (answeredQuestionIndex > -1) {
                currentLevelQuestions.splice(answeredQuestionIndex, 1);
                console.log("PREGUNTAS: Pregunta eliminada. Preguntas restantes en nivel:", currentLevelQuestions.length);
            }

            food = {};
            rat = {};

            gamePausedForQuestion = true;
            shouldPresentNewQuestion = true;
            checkAndPresentQuestion();
        }

        let shouldPresentNewQuestion = false;

        function checkAndPresentQuestion() {
            if (shouldPresentNewQuestion) {
                shouldPresentNewQuestion = false;
                currentQuestionDisplay.innerText = "Preparando nueva pregunta...";

                setTimeout(() => {
                    if (questionsAnsweredInCycle >= QUESTIONS_TO_LEVEL_UP) {
                        console.log("NIVEL: Intentando subir de nivel...");
                        if (level < Object.keys(selectedGradeQuestions).length) {
                            levelUp();
                            return;
                        } else {
                            endGame(true);
                            return;
                        }
                    }
                    presentQuestion();
                }, 1000);
            }
        }

        function levelUp() {
            level++;
            gameSpeed = Math.max(50, gameSpeed - 25);
            targetFrameRate = 1000 / (1000 / gameSpeed);
            levelDisplay.innerText = "Nivel: " + level;
            questionsCorrectInCycle = 0;
            questionsAnsweredInCycle = 0;
            shouldPresentNewQuestion = false;
            console.log(`NIVEL: ¡Subiste al Nivel ${level}! Velocidad: ${gameSpeed}ms.`);
            loadLevelQuestionsForCurrentLevel();
            currentQuestionDisplay.innerText = `¡Nivel ${level} alcanzado!`;
            setTimeout(() => {
                currentQuestionDisplay.innerText = "";
                presentQuestion();
            }, 1500);
        }

        // --- BUCLE PRINCIPAL DEL JUEGO (requestAnimationFrame) ---
        function gameLoop(currentTime) {
            animationFrameId = requestAnimationFrame(gameLoop);

            const elapsed = currentTime - lastFrameTime;
            if (elapsed < targetFrameRate) {
                return;
            }
            lastFrameTime = currentTime - (elapsed % targetFrameRate);

            if (gamePausedForQuestion) {
                return;
            }

            draw();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < snake.length; i++) {
                ctx.fillStyle = i === 0 ? "lime" : "green";
                ctx.strokeStyle = "darkgreen";
                ctx.fillRect(snake[i].x, snake[i].y, box, box);
                ctx.strokeRect(snake[i].x, snake[i].y, box, box);
            }

            if (food.x !== undefined) {
                ctx.fillStyle = "red";
                ctx.beginPath();
                ctx.arc(food.x + box / 2, food.y + box / 2, box / 2 - 2, 0, Math.PI * 2);
                ctx.fill();
            }

            if (rat.x !== undefined) {
                ctx.fillStyle = "gray";
                ctx.fillRect(rat.x + 2, rat.y + 2, box - 4, box - 4);
            }

            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if (moveQueue.length > 0) {
                while (moveQueue.length > 0 && direction !== null &&
                       ((moveQueue[0] === 'LEFT' && direction === 'RIGHT') ||
                        (moveQueue[0] === 'RIGHT' && direction === 'LEFT') ||
                        (moveQueue[0] === 'UP' && direction === 'DOWN') ||
                        (moveQueue[0] === 'DOWN' && direction === 'UP'))) {
                    moveQueue.shift();
                }
                if (moveQueue.length > 0) {
                    direction = moveQueue.shift();
                }
            }


            if (direction === "LEFT") snakeX -= box;
            if (direction === "UP") snakeY -= box;
            if (direction === "RIGHT") snakeX += box;
            if (direction === "DOWN") snakeY += box;

            let newHead = { x: snakeX, y: snakeY };

            if (
                snakeX < 0 ||
                snakeX >= canvas.width ||
                snakeY < 0 ||
                snakeY >= canvas.height ||
                collision(newHead, snake)
            ) {
                endGame(false);
                return;
            }

            snake.unshift(newHead);

            let eaten = false;
            if (newHead.x === food.x && newHead.y === food.y) {
                checkAnswer(true);
                eaten = true;
            } else if (newHead.x === rat.x && newHead.y === rat.y) {
                checkAnswer(false);
                eaten = true;
            }

            if (!eaten && segmentsToAdd <= 0) {
                snake.pop();
            } else if (segmentsToAdd > 0) {
                segmentsToAdd--;
            }

            // Si no hay comida disponible y el juego no está pausado por pregunta, continuar movimiento
            if (food.x === undefined && rat.x === undefined && !gamePausedForQuestion) {
                // Continuar el juego normalmente sin comida hasta que se presente nueva pregunta
            }
        }


        function setSnakeDirection(newDirection) {
            // Si el juego está pausado por una pregunta, no permitir movimientos de la serpiente.
            if (gamePausedForQuestion) {
                 return;
            }

            // Si la dirección es null (primer movimiento al inicio del juego), la establece directamente
            if (direction === null) {
                direction = newDirection;
                moveQueue.push(newDirection);
                return;
            }

            // Prevenir giro de 180 grados
            if (direction !== null &&
                ((newDirection === "LEFT" && direction === "RIGHT") ||
                 (newDirection === "RIGHT" && direction === "LEFT") ||
                 (newDirection === "UP" && direction === "DOWN") ||
                 (newDirection === "UP" && direction === "DOWN"))) {
                console.log("DIRECCIÓN: Intento de giro de 180 grados ignorado.");
                return;
            }

            // Añadir el movimiento a la cola si no es el mismo que el último en cola (o si la cola está vacía)
            if (moveQueue.length === 0 || moveQueue[moveQueue.length - 1] !== newDirection) {
                moveQueue.push(newDirection);
            }
        }

        // --- CONTROL DE GAME OVER / VICTORIA ---
        function endGame(isVictory) {
            stopAnimationFrameLoop();
            clearInterval(overlayQuestionTimerInterval);
            gamePausedForQuestion = true;
            gameOverScreen.style.display = "flex";
            currentQuestionDisplay.innerText = "";
            questionOverlay.style.display = "none";
            questionOverlay.classList.remove('slide-out');
            questionOverlay.style.transform = 'translate(-50%, -50%)';
            questionOverlay.style.opacity = '1';

            // Asegurarse de ocultar las instrucciones iniciales si están visibles
            initialInstructionsOverlay.style.display = "none"; 

            if (isVictory) {
                gameOverTitle.innerText = "¡Felicidades, Juego Completado!";
                finalScoreDisplay.innerText = `¡Has respondido todas las preguntas de tu grado!\nPuntaje final: ${score}`;
            } else {
                gameOverTitle.innerText = "¡Juego Terminado!";
                finalScoreDisplay.innerText = `Puntaje final: ${score}`;
            }
        }

        // --- INICIAR / DETENER BUCLE requestAnimationFrame ---
        function startAnimationFrameLoop() {
            if (!animationFrameId) {
                lastFrameTime = performance.now();
                animationFrameId = requestAnimationFrame(gameLoop);
                console.log("ANIMACIÓN: Bucle requestAnimationFrame iniciado.");
            }
        }

        function stopAnimationFrameLoop() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                console.log("ANIMACIÓN: Bucle requestAnimationFrame detenido.");
            }
        }

        // --- EVENTO DE REINICIO ---
        restartButton.addEventListener("click", showStartScreen); // Volver a la pantalla de inicio al reiniciar
        restartButton.addEventListener("touchend", (e) => {
            e.preventDefault();
            showStartScreen();
        }, { passive: false });

        // --- MANEJADORES DE EVENTOS DE TECLADO Y TÁCTILES ---
        // Listener de teclado para control de serpiente
        document.addEventListener("keydown", (event) => {
            let newDirection;
            switch (event.keyCode) {
                case 37: newDirection = "LEFT"; break;
                case 38: newDirection = "UP"; break;
                case 39: newDirection = "RIGHT"; break;
                case 40: newDirection = "DOWN"; break;
                default: return; // Ignorar otras teclas
            }
            setSnakeDirection(newDirection);
        });

        // --- Modified to listen to touch events on the body ---
        document.body.addEventListener('touchstart', (e) => {
            // Don't prevent default for buttons and interactive elements
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                return;
            }

            if (e.touches.length > 0) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();

                // Solo prevenir default si no es un elemento interactivo
                e.preventDefault();
            }
        }, { passive: false });

        document.body.addEventListener('touchmove', (e) => {
            // Don't prevent default for buttons and interactive elements
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                return;
            }

            // Prevenir scroll siempre para evitar comportamientos inesperados en iOS
            e.preventDefault();

            // Solo procesar gestos si el juego está activo
            if (!gamePausedForQuestion && e.touches.length > 0) {
                const currentX = e.touches[0].clientX;
                const currentY = e.touches[0].clientY;
                const deltaX = currentX - touchStartX;
                const deltaY = currentY - touchStartY;
                const timeDiff = Date.now() - touchStartTime;

                // Detección más sensible para iOS
                if (timeDiff < 300 && timeDiff > 50 && (Math.abs(deltaX) > SWIPE_THRESHOLD || Math.abs(deltaY) > SWIPE_THRESHOLD)) {
                    let newDirection = null;

                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        newDirection = deltaX > 0 ? 'RIGHT' : 'LEFT';
                    } else {
                        newDirection = deltaY > 0 ? 'DOWN' : 'UP';
                    }

                    if (newDirection) {
                        setSnakeDirection(newDirection);
                        console.log("EVENTO: Gesto táctil rápido detectado:", newDirection);
                        // Resetear para evitar múltiples detecciones
                        touchStartTime = 0;
                    }
                }
            }
        }, { passive: false });

        document.body.addEventListener('touchend', (e) => {
            // Don't prevent default for buttons and interactive elements
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                return;
            }

            e.preventDefault();

            if (gamePausedForQuestion) return;
            if (e.changedTouches.length === 0) return;
            if (touchStartTime === 0) return; // Ya fue procesado en touchmove

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const timeDiff = Date.now() - touchStartTime;

            let newDirection = null;

            // Procesar solo si no fue procesado en touchmove y el gesto es válido
            if (timeDiff > 50 && (Math.abs(deltaX) > SWIPE_THRESHOLD || Math.abs(deltaY) > SWIPE_THRESHOLD)) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    newDirection = deltaX > 0 ? 'RIGHT' : 'LEFT';
                } else {
                    newDirection = deltaY > 0 ? 'DOWN' : 'UP';
                }

                if (newDirection) {
                    setSnakeDirection(newDirection);
                    console.log("EVENTO: Gesto táctil detectado en touchend:", newDirection);
                }
            }

            // Resetear variables
            touchStartTime = 0;
        }, { passive: false });

        // Prevent zoom gestures with multiple touches
        document.body.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.body.addEventListener('gesturechange', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.body.addEventListener('gestureend', (e) => {
            e.preventDefault();
        }, { passive: false });

        // Mouse event handlers (for computers without touch screens or when using the mouse)
        // These listeners are only activated if isMobile is false.
        document.body.addEventListener('mousedown', (e) => {
            if (isMobile || gamePausedForQuestion) return;
            mouseIsDown = true;
            mouseStartX = e.clientX;
            mouseStartY = e.clientY;
            e.preventDefault();
        });

        document.body.addEventListener('mouseup', (e) => {
            if (!mouseIsDown || isMobile || gamePausedForQuestion) return;
            mouseIsDown = false;

            const mouseEndX = e.clientX;
            const mouseEndY = e.clientY;

            const deltaX = mouseEndX - mouseStartX;
            const deltaY = mouseEndY - mouseStartY;

            let newDirection = null;

            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > SWIPE_THRESHOLD) {
                newDirection = deltaX > 0 ? 'RIGHT' : 'LEFT';
            } else if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > SWIPE_THRESHOLD) {
                newDirection = deltaY > 0 ? 'DOWN' : 'UP';
            }

            if (newDirection) {
                setSnakeDirection(newDirection);
            }
            e.preventDefault();
        });

        document.body.addEventListener('mousemove', (e) => {
            if (!mouseIsDown || isMobile || gamePausedForQuestion) return;
            e.preventDefault();
        });

        // --- MANEJAR REDIMENSIONAMIENTO DE VENTANA ---
        window.addEventListener('resize', () => {
            adjustCanvasSize();
        });

        // Manejar cambios de orientación en móviles
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                adjustCanvasSize();
            }, 100);
        });

        // --- INICIAR LA PANTALLA DE INICIO AL CARGAR LA PÁGINA ---
        window.onload = () => {
            adjustCanvasSize();
            showStartScreen();
        };

    </script>
</body>
</html>
